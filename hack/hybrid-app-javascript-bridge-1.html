<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"inwoo.me",root:"/",scheme:"Mist",version:"7.7.1",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!0,color:"#f2777a",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"O53TIH124Y",apiKey:"8ed06f70ea649e0bf006a20053097d7e",indexName:"blog",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="在移动互联快速发展的今天，越来越多的应用采用Hybrid（混合模式）的开发方式。所谓的混合模式就是采用原生应用和网页应用相结合，我们熟知的手机淘宝就是采用了混合模式的应用，而微信甚至提供了JSSDK作为对公众号开发WEB应用的支持和扩展。混合模式开发最大的好处就是能快速迭代并且跨平台。快速迭代是因为所有视图和业务层面的代码都将由WEB去进行处理，对于节日活动、更换风格、修改逻辑等非核心功能的修改只"><meta property="og:type" content="article"><meta property="og:title" content="混合应用的JavaScript Bridge（一）"><meta property="og:url" content="http://inwoo.me/hack/hybrid-app-javascript-bridge-1.html"><meta property="og:site_name" content="Woo&#39;s Blog"><meta property="og:description" content="在移动互联快速发展的今天，越来越多的应用采用Hybrid（混合模式）的开发方式。所谓的混合模式就是采用原生应用和网页应用相结合，我们熟知的手机淘宝就是采用了混合模式的应用，而微信甚至提供了JSSDK作为对公众号开发WEB应用的支持和扩展。混合模式开发最大的好处就是能快速迭代并且跨平台。快速迭代是因为所有视图和业务层面的代码都将由WEB去进行处理，对于节日活动、更换风格、修改逻辑等非核心功能的修改只"><meta property="article:published_time" content="2016-01-15T04:16:32.000Z"><meta property="article:modified_time" content="2020-02-29T10:33:03.548Z"><meta property="article:author" content="Jim Woo"><meta property="article:tag" content="JavaScript"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://inwoo.me/hack/hybrid-app-javascript-bridge-1.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>混合应用的JavaScript Bridge（一） | Woo's Blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Woo's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Just Do & Write it !</h1></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans"><link itemprop="mainEntityOfPage" href="http://inwoo.me/hack/hybrid-app-javascript-bridge-1.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar.jpg"><meta itemprop="name" content="Jim Woo"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Woo's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">混合应用的JavaScript Bridge（一）</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2016-01-15 12:16:32" itemprop="dateCreated datePublished" datetime="2016-01-15T12:16:32+08:00">2016-01-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2020-02-29 18:33:03" itemprop="dateModified" datetime="2020-02-29T18:33:03+08:00">2020-02-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/hack/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>在移动互联快速发展的今天，越来越多的应用采用Hybrid（混合模式）的开发方式。所谓的混合模式就是采用原生应用和网页应用相结合，我们熟知的<strong>手机淘宝</strong>就是采用了混合模式的应用，而<strong>微信甚至提供了JSSDK</strong>作为对公众号开发WEB应用的支持和扩展。</p><p>混合模式开发最大的好处就是能快速迭代并且跨平台。快速迭代是因为所有视图和业务层面的代码都将由WEB去进行处理，对于节日活动、更换风格、修改逻辑等非核心功能的修改只需更新WEB的线上代码而无需对原生代码进行修改，这样的方式无需用户对手机上的应用进行下载更新便可达到线上更新。跨平台也是显而易见的优势，主流移动设备主要是IOS和Android两大平台，对HTML5都有着很好的支持。</p><p>那今天主要以前端的视角来带大家看一下如何从零开始实现原生应用和JavaScript的通讯。</p><a id="more"></a><h2>平台之分</h2><p>当今主流的移动设备平台主要分为 <em>IOS</em> 和 <em>Android</em>（WinPhone市场占有率低到只能忽略），由于它们之间的架构差异导致了对 WebView 进行通讯的方式也不一样，而我们需要实现的是一个跨平台的通用的“接口”，所以在开始之前我们先要梳理一下它们平台之间的差异化。</p><h4>Android</h4><p>Android 平台下可对 WebView 添加 JavaScript 对象，在创建一个WebView 之后可调用 [addJavascriptInterface](<a href="http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface" target="_blank" rel="noopener">http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface</a>(java.lang.Object, java.lang.String)) 插入一个 JavaScript 的对象并且绑定到原生的对象上。</p><blockquote>Injects the supplied Java object into this WebView. The object is injected into the JavaScript context of the main frame, using the supplied name. This allows the Java object's methods to be accessed from JavaScript.</blockquote><pre class="decode:true lang:java"><code> class JsObject {
    @JavascriptInterface
    public String toString() { return "injectedObject"; }
 }
 webView.addJavascriptInterface(new JsObject(), "injectedObject");
 webView.loadData("", "text/html", null);
 webView.loadUrl("javascript:alert(injectedObject.toString())");
</code></pre><p>上面的官方例子中将 Java 对象 JsObject 通过 <code>addJavascriptInterface (Object object, String name)</code> 的方法以 <code>injectedObject</code> 的名字插入到 WebView 的 JavaScript 上下文中，即 <code>window.injectedObject</code>。</p><p>Android 提供了 <code>addJavascriptInterface</code> 方法，显然对于 JavaScript 发送信息到原生应用上实现起来就更简单了。那么原生应用发送信息到 JavaScript 则通过更改url实现。</p><pre class="decode:true lang:java"><code><br>webView.loadUrl("javascript:alert(injectedObject.toString())");
</code></pre><h4>IOS</h4><p>IOS 相比 Android 则显得没那么友好，需要通过对 <strong>UrlScheme</strong> 监听以达到获取心的消息（来自WebView）通知的效果。</p><p>原生应用设置好监听的 UrlScheme 后，当 WebView 需要发送消息的时候则请求访问约定的链接，原生应用利用<code>stringByEvaluatingJavaScriptFromString</code>或者<code>evaluateJavascript</code>获取详细信息并且进行处理。<strong>IOS平台与Android平台实现通讯的最大区别在于，Android 被动接收由 JavaScript 推送过来的内容，但 IOS 上则是通过监听由 WebView 发起一个指定URL的请求后，主动执行 JavaScript 的方法并且获取返回值</strong>。</p><p>需要注意的是 UIWebView 使用的是<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWebView_Class/#//apple_ref/occ/instm/UIWebView/stringByEvaluatingJavaScriptFromString:" target="_blank" rel="noopener">stringByEvaluatingJavaScriptFromString</a>，而 WKWebView 使用的是<a href="https://developer.apple.com/library/ios/documentation/WebKit/Reference/WKWebView_Ref/index.html#//apple_ref/occ/instm/WKWebView/evaluateJavaScript:completionHandler:" target="_blank" rel="noopener">evaluateJavascript</a>。</p><pre class="decode:true lang:object-c"><code>(void)evaluateJavaScript:(NSString *)javaScriptString
         completionHandler:(void (^)(id,
                                     NSError *error))completionHandler

- (NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script
</code></pre><p><em>其中官方文档中说明IOS8之后WKWebView将会替代UIWebView.</em></p><h2>总结</h2><p>通过对以上两个平台如何实现与JavaScript通讯的了解后，发现他们之间的实现方式和通讯方式天差地别，所以我们要实现一个跨平台的通讯方式只有从 JavaScript 上面入手。下一篇文章将介绍如何设计一个跨平台的 JSSDK。</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/js/" rel="tag"># JavaScript</a></div><div class="post-nav"><div class="post-nav-item"><a href="/hack/what-is-bfc.html" rel="prev" title="说一说BFC"><i class="fa fa-chevron-left"></i> 说一说BFC</a></div><div class="post-nav-item"><a href="/hack/hybrid-app-javascript-bridge-2.html" rel="next" title="混合应用的JavaScript Bridge（二）">混合应用的JavaScript Bridge（二） <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.</span> <span class="nav-text">平台之分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.0.1.</span> <span class="nav-text">Android</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.0.2.</span> <span class="nav-text">IOS</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">2.</span> <span class="nav-text">总结</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Jim Woo" src="/uploads/avatar.jpg"><p class="site-author-name" itemprop="name">Jim Woo</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">18</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">2</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zqjimlove" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zqjimlove" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:zqjimlove@gmail.com" title="E-Mail → mailto:zqjimlove@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-at"></i>E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Jim Woo</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0</div><span class="post-meta-divider">|</span><div class="powered-by">Hosted by <a href="https://pages.coding.me" target="_blank" rel="noopener">Coding Pages</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.1</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      script.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});</script><script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/algolia-search.js"></script><div id="pjax"></div></body></html>